<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cosmic Chat</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
    margin:0;
    font-family:Arial, sans-serif;
    background:black;
    overflow:hidden;
    color:white;
}

/* CANVAS */
canvas{
    position:fixed;
    top:0;
    left:0;
    z-index:-1;
}

/* CHAT */
#chat-box{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    width:420px;
    height:600px;
    background:rgba(0,0,0,0.7);
    backdrop-filter:blur(12px);
    border-radius:20px;
    display:flex;
    flex-direction:column;
    box-shadow:0 0 40px rgba(0,255,255,0.4);
    animation:float 6s ease-in-out infinite;
}

@keyframes float{
    0%,100%{transform:translate(-50%,-50%) translateY(0px);}
    50%{transform:translate(-50%,-50%) translateY(-10px);}
}

#messages{
    flex:1;
    overflow-y:auto;
    padding:15px;
}

.message{
    margin-bottom:12px;
    animation:fade 0.4s ease;
}

@keyframes fade{
    from{opacity:0;transform:translateY(10px);}
    to{opacity:1;transform:translateY(0);}
}

.time{
    font-size:11px;
    opacity:0.6;
}

#input-area{
    display:flex;
    padding:10px;
}

#chat-input{
    flex:1;
    border:none;
    border-radius:10px;
    padding:8px;
}

button{
    margin-left:6px;
    border:none;
    border-radius:10px;
    padding:8px 12px;
    background:cyan;
    cursor:pointer;
}

/* TODO */
#todo{
    position:absolute;
    right:20px;
    top:20px;
    width:220px;
    background:rgba(0,0,0,0.6);
    padding:15px;
    border-radius:15px;
}

#auth{
    position:absolute;
    top:20px;
    left:20px;
}
</style>
</head>

<body>

<canvas id="space"></canvas>

<div id="auth">
    <input id="email" placeholder="email">
    <input id="password" type="password" placeholder="password">
    <button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    <button onclick="login()">–í—Ö–æ–¥</button>
</div>

<div id="chat-box">
    <div id="messages"></div>
    <div id="input-area">
        <input id="chat-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<div id="todo">
    <h3>üöÄ ToDo</h3>
    <input id="todo-input" placeholder="–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞">
    <button onclick="addTodo()">+</button>
    <ul id="todo-list"></ul>
</div>

<script>
const SUPABASE_URL="YOUR_URL";
const SUPABASE_ANON_KEY="YOUR_KEY";
const sb = supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

let user=null;

/* AUTH */
async function register(){
    await sb.auth.signUp({
        email:email.value,
        password:password.value
    });
    alert("–ü—Ä–æ–≤–µ—Ä—å –ø–æ—á—Ç—É");
}

async function login(){
    const {data}=await sb.auth.signInWithPassword({
        email:email.value,
        password:password.value
    });
    user=data.user;
}

/* CHAT */
async function sendMessage() {

    const input = document.getElementById("chat-input");
    const value = input.value.trim();

    if (!value || !user) return;

    const time = new Date().toLocaleTimeString();

    await sb.from("messages").insert({
        text: value,
        user: user.email,
        time: time
    });

    input.value = "";
}

sb.channel("chat")
.on("postgres_changes",
{event:"INSERT",schema:"public",table:"messages"},
payload=>{
    const msg=document.createElement("div");
    msg.className="message";
    msg.innerHTML=`<b>${payload.new.user}</b>: ${payload.new.text}
    <div class="time">${payload.new.time}</div>`;
    messages.appendChild(msg);
    new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg").play();
})
.subscribe();

/* TODO */
function addTodo(){
    const li=document.createElement("li");
    li.textContent=todo-input.value;
    todo-list.appendChild(li);
    todo-input.value;"";
}

/* SPACE ANIMATION */
const canvas=document.getElementById("space");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let stars=[];
for(let i=0;i<200;i++){
    stars.push({
        x:Math.random()*canvas.width,
        y:Math.random()*canvas.height,
        size:Math.random()*2
    });
}

let astronauts=[
    {x:100,y:200,speed:0.5},
    {x:500,y:400,speed:0.3}
];

let ufo={x:0,y:100,speed:1};

let asteroids=[];
for(let i=0;i<5;i++){
    asteroids.push({
        x:Math.random()*canvas.width,
        y:Math.random()*canvas.height,
        speed:2+Math.random()*2
    });
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    /* stars */
    ctx.fillStyle="white";
    stars.forEach(s=>{
        ctx.fillRect(s.x,s.y,s.size,s.size);
    });

    /* planets */
    ctx.fillStyle="purple";
    ctx.beginPath();
    ctx.arc(200,150,60,0,Math.PI*2);
    ctx.fill();

    /* astronauts */
    ctx.fillStyle="white";
    astronauts.forEach(a=>{
        ctx.beginPath();
        ctx.arc(a.x,a.y,10,0,Math.PI*2);
        ctx.fill();
        a.y+=a.speed;
        if(a.y>canvas.height)a.y=0;
    });

    /* ufo */
    ctx.fillStyle="lime";
    ctx.fillRect(ufo.x,ufo.y,40,15);
    ufo.x+=ufo.speed;
    if(ufo.x>canvas.width)ufo.x=-50;

    /* asteroids */
    ctx.fillStyle="gray";
    asteroids.forEach(a=>{
        ctx.beginPath();
        ctx.arc(a.x,a.y,8,0,Math.PI*2);
        ctx.fill();
        a.y+=a.speed;
        if(a.y>canvas.height)a.y=0;
    });

    requestAnimationFrame(draw);
}

draw();
</script>

</body>
</html>