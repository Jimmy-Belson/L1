<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ORBITRON v10.3</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --n: #00f2ff; --p: #ff00ff; --bg: #01050a; --glass: rgba(0, 242, 255, 0.05); --border: rgba(0, 242, 255, 0.2); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg); color: var(--n); font-family: 'Share Tech Mono', monospace; height: 100vh; overflow: hidden; position: relative; }
        
        body::after {
            content: ""; position: fixed; inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 242, 255, 0.01) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.005), rgba(0, 255, 0, 0.002), rgba(0, 0, 255, 0.005));
            background-size: 100% 4px, 3px 100%; z-index: 100; pointer-events: none;
        }

        #starfield { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        .os-container { position: relative; z-index: 10; display: flex; flex-direction: column; height: 100vh; padding: 20px; }
        
        /* ЭКРАН ВХОДА - ГИПЕРСТИЛЬ */
        #auth-gate { 
            position: fixed; inset: 0; z-index: 200; 
            background: radial-gradient(circle at center, #0a1018 0%, #01050a 100%); 
            display: flex; align-items: center; justify-content: center; 
        }
        .auth-form { 
            width: 400px; padding: 40px; 
            border: 1px solid var(--border); 
            background: rgba(0, 242, 255, 0.02);
            box-shadow: 0 0 50px rgba(0,0,0,1), inset 0 0 20px rgba(0, 242, 255, 0.05);
            position: relative;
            backdrop-filter: blur(10px);
        }
        /* Угловые элементы рамки */
        .auth-form::before, .auth-form::after {
            content: ""; position: absolute; width: 20px; height: 20px; border: 2px solid var(--n);
        }
        .auth-form::before { top: -2px; left: -2px; border-right: 0; border-bottom: 0; }
        .auth-form::after { bottom: -2px; right: -2px; border-left: 0; border-top: 0; }

        .auth-form h1 { font-family: 'Orbitron'; font-size: 18px; margin-bottom: 30px; letter-spacing: 4px; text-shadow: 0 0 10px var(--n); }
        
        .auth-input-group { margin-bottom: 20px; text-align: left; }
        .auth-input-group label { font-size: 9px; color: var(--p); display: block; margin-bottom: 5px; letter-spacing: 1px; }
        
        .auth-form input { 
            width: 100%; background: rgba(0,0,0,0.8); border: 1px solid var(--border); 
            padding: 12px; color: #fff; font-family: 'Share Tech Mono'; outline: none;
            transition: 0.3s;
        }
        .auth-form input:focus { border-color: var(--n); box-shadow: 0 0 15px rgba(0, 242, 255, 0.2); }

        .login-btn { 
            width: 100%; padding: 15px; background: transparent; 
            border: 1px solid var(--n); color: var(--n); 
            font-family: 'Orbitron'; font-size: 12px; cursor: pointer; 
            transition: 0.3s; margin-top: 10px;
        }
        .login-btn:hover { background: var(--n); color: #000; box-shadow: 0 0 20px var(--n); }

        /* ОСТАЛЬНОЙ ВИЗУАЛ */
        header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; border-bottom: 1px solid var(--border); margin-bottom: 20px; font-family: 'Orbitron'; background: rgba(1,5,10,0.5); }
        .status-block { display: flex; flex-direction: column; align-items: flex-end; }
        .status-bar { width: 80px; height: 2px; background: rgba(0, 242, 255, 0.1); margin-top: 5px; position: relative; overflow: hidden; }
        .status-fill { position: absolute; height: 100%; background: var(--p); animation: statusMove 4s infinite ease-in-out; }
        @keyframes statusMove { 0% { width: 10%; left: 0; } 50% { width: 80%; left: 10%; } 100% { width: 10%; left: 90%; } }

        .main-area { display: flex; flex: 1; gap: 40px; overflow: hidden; }
        .panel { background: var(--glass); backdrop-filter: blur(15px); border: 1px solid var(--border); display: flex; flex-direction: column; }
        .todo-panel { width: 300px; flex-shrink: 0; }
        #todo-list { flex: 1; overflow-y: auto; padding: 10px; scrollbar-width: none; }
        
        .chat-wrapper { flex: 1; display: flex; justify-content: center; }
        .chat-panel { width: 100%; max-width: 550px; height: 100%; }
        #chat-stream { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; scrollbar-width: none; }
        
        .input-box { display: flex; gap: 10px; padding: 15px; background: rgba(0,0,0,0.4); border-top: 1px solid var(--border); }
        .hidden { display: none !important; }

        .audio-link { display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 5px 12px; border: 1px solid var(--border); font-size: 10px; transition: 0.3s; }
        .audio-link:hover { border-color: var(--p); box-shadow: 0 0 10px var(--p); }
        .bars { display: flex; align-items: flex-end; gap: 2px; height: 15px; }
        .bar { width: 2px; height: 4px; background: var(--n); }
        .playing .bar { animation: wave 0.5s infinite alternate; }
        @keyframes wave { from { height: 4px; } to { height: 15px; background: var(--p); } }
        @keyframes msgAppear { to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
<canvas id="starfield"></canvas>

<div id="auth-gate">
    <div class="auth-form">
        <h1>STATION_LOGIN</h1>
        <div class="auth-input-group">
            <label>IDENTIFICATION_MAIL</label>
            <input type="email" id="email" placeholder="---" autocomplete="off">
        </div>
        <div class="auth-input-group">
            <label>ENCRYPTION_KEY</label>
            <input type="password" id="pass" placeholder="---">
        </div>
        <button class="login-btn" onclick="Core.Auth()">INITIATE_SESSION</button>
        <div style="margin-top: 20px; font-size: 8px; color: var(--border); letter-spacing: 2px;">SECURE_CONNECTION_STABLE</div>
    </div>
</div>

<div class="os-container">
    <header>
        <div>ORBITRON_OS // v10.3</div>
        <div style="display: flex; align-items: center; gap: 20px;">
            <div id="audio-btn" class="audio-link" onclick="Core.Audio.toggle()">
                LINK_AUDIO <div class="bars"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
            </div>
            <div class="status-block">
                <div id="clock">00:00:00</div>
                <div class="status-bar"><div class="status-fill"></div></div>
            </div>
        </div>
    </header>
    <div class="main-area">
        <aside class="panel todo-panel">
            <div style="padding:15px; font-size:10px; border-bottom:1px solid var(--border)">MISSION_LOGS</div>
            <div class="input-box"><input type="text" id="todo-in" placeholder="ADD TASK..."></div>
            <div id="todo-list"></div>
        </aside>
        <div class="chat-wrapper">
            <main class="panel chat-panel">
                <div id="chat-stream"></div>
                <div class="input-box"><input type="text" id="chat-in" placeholder="MESSAGE..."><button onclick="Core.Chat.send()">SEND</button></div>
            </main>
        </div>
    </div>
</div>

<script>
const Core = {
    sb: window.supabase.createClient('https://ebjsxlympwocluxgmwcu.supabase.co', 'sb_publishable_8HhPj3Y8g5V7Np8Vy5xbzQ_2B7LjTkj'),
    user: null,
    init() {
        this.Canvas.init(); this.Audio.setup(); this.UI();
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('ru-RU', { hour12: false });
        }, 1000);
        this.sb.auth.onAuthStateChange((_, s) => { if(s) { this.user = s.user; document.getElementById('auth-gate').classList.add('hidden'); this.Chat.load(); }});
        this.loop();
    },
    Auth: async () => {
        const btn = document.querySelector('.login-btn');
        btn.innerText = 'AUTHENTICATING...';
        const e = document.getElementById('email').value, p = document.getElementById('pass').value;
        const { error } = await Core.sb.auth.signInWithPassword({email:e, password:p});
        if(error) { alert(error.message); btn.innerText = 'INITIATE_SESSION'; }
    },
    Audio: {
        playing: false,
        setup() { this.el = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3'); this.el.loop = true; },
        toggle() {
            const b = document.getElementById('audio-btn');
            if(this.el.paused) { this.el.play(); b.classList.add('playing'); this.playing = true; }
            else { this.el.pause(); b.classList.remove('playing'); this.playing = false; }
        }
    },
    Chat: {
        async load() { const { data } = await Core.sb.from('comments').select('*').order('created_at', {ascending:true}); if(data) { document.getElementById('chat-stream').innerHTML = ''; data.forEach(m => this.render(m)); } },
        render(m) { const s = document.getElementById('chat-stream'), d = document.createElement('div'); d.className = 'msg-container'; d.innerHTML = `<div class="msg-nick">${(m.nickname||'PILOT').toUpperCase()}</div><div class="msg-text" style="color:#fff; font-size:13px; background:rgba(0,242,255,0.05); padding:10px; border-radius:4px; border-left: 2px solid var(--n);">${m.message}</div>`; s.appendChild(d); s.scrollTop = s.scrollHeight; },
        async send() { const i = document.getElementById('chat-in'); if(!i.value || !this.user) return; const n = this.user.email.split('@')[0], v = i.value; i.value = ''; this.render({nickname: n, message: v}); await Core.sb.from('comments').insert([{message: v, nickname: n}]); }
    },
    UI() {
        document.getElementById('todo-in').onkeypress = (e) => { if(e.key === 'Enter' && e.target.value) { const d = document.createElement('div'); d.style.padding = '10px'; d.style.borderBottom = '1px solid rgba(0,242,255,0.1)'; d.innerText = '> ' + e.target.value.toUpperCase(); d.onclick = () => d.remove(); document.getElementById('todo-list').prepend(d); e.target.value = ''; } };
        document.getElementById('chat-in').onkeypress = (e) => { if(e.key === 'Enter') this.Chat.send(); };
    },
    Canvas: {
        init() {
            this.cvs = document.getElementById('starfield'); this.ctx = this.cvs.getContext('2d'); this.res();
            window.addEventListener('resize', () => this.res());
            this.stars = Array.from({length:200}, () => ({x:Math.random()*this.cvs.width, y:Math.random()*this.cvs.height, s:Math.random()*2, v:Math.random()*0.3, b:Math.random()}));
            this.crew = Array.from({length:3}, () => ({x:Math.random()*this.cvs.width, y:Math.random()*this.cvs.height, rot:Math.random()*6, vr:0.005, vx:(Math.random()-0.5)*0.3, vy:(Math.random()-0.5)*0.3}));
        },
        res() { this.cvs.width = window.innerWidth; this.cvs.height = window.innerHeight; },
        draw() {
            const ctx = this.ctx, cvs = this.cvs; ctx.fillStyle = '#01050a'; ctx.fillRect(0,0,cvs.width,cvs.height);
            this.stars.forEach(s => { 
                s.x -= s.v; if(s.x < 0) s.x = cvs.width;
                let mPulse = Core.Audio.playing ? Math.abs(Math.sin(Date.now()*0.01))*0.4 : 0;
                ctx.fillStyle = `rgba(255,255,255,${0.3 + Math.abs(Math.sin(Date.now()*0.001 + s.b*10))*0.7 + mPulse})`;
                ctx.beginPath(); ctx.arc(s.x, s.y, s.s/2, 0, Math.PI*2); ctx.fill(); 
            });
            this.crew.forEach(a => { 
                a.x += a.vx; a.y += a.vy; a.rot += a.vr; if(a.x < -50) a.x = cvs.width+50; if(a.y < -50) a.y = cvs.height+50;
                ctx.save(); ctx.translate(a.x, a.y); ctx.rotate(a.rot); ctx.fillStyle = '#fff'; ctx.fillRect(-8,-12,16,24); ctx.restore();
            });
            const px = cvs.width * 0.85, py = cvs.height * 0.3;
            let pg = ctx.createRadialGradient(px-30, py-30, 10, px, py, 110); pg.addColorStop(0, '#00f2ff'); pg.addColorStop(1, '#01050a'); ctx.fillStyle = pg; ctx.beginPath(); ctx.arc(px, py, 110, 0, Math.PI*2); ctx.fill();
        }
    },
    loop() { Core.Canvas.draw(); requestAnimationFrame(() => Core.loop()); }
};
window.onload = () => Core.init();
</script>
</body>
</html>