<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ORBITRON OS v8.5 - ULTIMATE</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --neon: #00f2ff;
            --plasma: #ff00ff;
            --void: #01050a;
            --panel-bg: rgba(5, 15, 25, 0.92);
            --border-glow: 0 0 15px rgba(0, 242, 255, 0.3);
            --font-main: 'Share Tech Mono', monospace;
            --font-ui: 'Orbitron', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }
        body { 
            background: var(--void); color: var(--neon); 
            font-family: var(--font-main); height: 100vh; overflow: hidden; 
        }

        /* --- POST-PROCESSING EFFECTS --- */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.05), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.05));
            z-index: 9999; background-size: 100% 4px, 4px 100%; pointer-events: none; opacity: 0.3;
        }
        .bloom {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, transparent 30%, rgba(0,0,0,0.6) 100%);
            z-index: 9998; pointer-events: none;
        }

        #starfield { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }

        /* --- SYSTEM LAYOUT --- */
        .os-container {
            position: relative; z-index: 100;
            display: grid;
            grid-template-columns: 380px 1fr 320px;
            grid-template-rows: 60px 1fr 200px;
            height: 100vh; gap: 12px; padding: 15px;
            pointer-events: none;
        }

        /* --- UI COMPONENTS --- */
        .glass-panel {
            background: var(--panel-bg);
            border: 1px solid rgba(0, 242, 255, 0.2);
            box-shadow: var(--border-glow);
            backdrop-filter: blur(12px);
            pointer-events: auto;
            display: flex; flex-direction: column;
            position: relative;
            overflow: hidden;
        }
        .glass-panel::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--neon), transparent);
        }

        .header-bar {
            grid-column: 1 / 4;
            display: flex; align-items: center; justify-content: space-between; padding: 0 25px;
        }
        .nav-brand { font-family: var(--font-ui); font-weight: 700; letter-spacing: 5px; font-size: 20px; }

        /* --- TERMINAL WINDOW --- */
        .main-display {
            grid-column: 2; grid-row: 2;
            display: flex; flex-direction: column;
        }
        .display-content { flex-grow: 1; position: relative; display: flex; flex-direction: column; }
        
        #auth-module {
            position: absolute; inset: 0; display: flex; flex-direction: column;
            justify-content: center; align-items: center; padding: 50px; z-index: 10;
        }

        /* --- CHAT ENGINE UI --- */
        #chat-engine { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; }
        #message-stream { 
            flex-grow: 1; overflow-y: scroll; padding: 25px; 
            display: flex; flex-direction: column; gap: 15px;
            scrollbar-width: thin; scrollbar-color: var(--neon) transparent;
        }
        .msg-frame { border-left: 3px solid var(--neon); padding: 10px 15px; background: rgba(0, 242, 255, 0.03); animation: slideIn 0.4s cubic-bezier(0,1,0.5,1); }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } }
        .msg-sender { font-family: var(--font-ui); font-size: 10px; color: var(--plasma); margin-bottom: 5px; text-transform: uppercase; }

        /* --- SIDEBARS --- */
        .sidebar-left { grid-row: 2 / 3; }
        .sidebar-right { grid-row: 2 / 3; }

        .module-title {
            background: rgba(0, 242, 255, 0.1); padding: 10px;
            font-family: var(--font-ui); font-size: 11px; letter-spacing: 2px;
            border-bottom: 1px solid rgba(0, 242, 255, 0.2);
        }

        /* --- INPUTS --- */
        .input-wrapper { padding: 20px; background: rgba(0,0,0,0.4); border-top: 1px solid rgba(0,242,255,0.1); display: flex; gap: 12px; }
        input {
            background: rgba(0, 10, 20, 0.8); border: 1px solid rgba(0, 242, 255, 0.3);
            color: #fff; padding: 14px; font-family: var(--font-main); outline: none; flex-grow: 1;
        }
        input:focus { border-color: var(--neon); box-shadow: 0 0 10px rgba(0, 242, 255, 0.2); }
        button {
            background: transparent; border: 1px solid var(--neon); color: var(--neon);
            padding: 10px 25px; font-family: var(--font-ui); cursor: pointer;
            transition: 0.3s; text-transform: uppercase; font-size: 12px;
        }
        button:hover { background: var(--neon); color: #000; box-shadow: 0 0 20px var(--neon); }

        /* --- TASK SYSTEM --- */
        .task-list { padding: 15px; overflow-y: auto; flex-grow: 1; }
        .task-card { 
            background: rgba(255,255,255,0.02); border: 1px solid rgba(0,242,255,0.05);
            padding: 12px; margin-bottom: 8px; cursor: pointer; transition: 0.2s;
        }
        .task-card:hover { background: rgba(0,242,255,0.05); border-color: var(--neon); }

        /* --- DATA FOOTER --- */
        .os-footer { grid-column: 1 / 4; display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 12px; }
        #live-logs { font-size: 10px; color: #555; padding: 15px; overflow-y: hidden; display: flex; flex-direction: column-reverse; }

        .hidden { display: none !important; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--neon); }

    </style>
</head>
<body>

<div class="scanlines"></div>
<div class="bloom"></div>
<canvas id="starfield"></canvas>

<div class="os-container">
    <header class="glass-panel header-bar">
        <div class="nav-brand">ORBITRON_OS // V8.5</div>
        <div id="system-clock" style="font-size: 18px; letter-spacing: 2px;">00:00:00</div>
        <div style="font-size: 10px; opacity: 0.6;">COORDINATES: <span id="nav-coords">X:0 Y:0 Z:0</span></div>
    </header>

    <aside class="glass-panel sidebar-left">
        <div class="module-title">MISSION_LOGS</div>
        <div class="input-wrapper" style="padding: 10px;">
            <input type="text" id="todo-entry" placeholder="> NEW LOG...">
        </div>
        <div id="mission-tasks" class="task-list"></div>
        <div style="padding: 15px; border-top: 1px solid rgba(0,242,255,0.1);">
            <div style="font-size: 10px; margin-bottom: 5px;">HULL_INTEGRITY</div>
            <div style="height: 4px; background: #111; width: 100%;"><div style="width: 88%; background: var(--neon); height: 100%;"></div></div>
        </div>
    </aside>

    <main class="glass-panel main-display">
        <div class="display-content">
            <section id="auth-module">
                <h1 style="font-family: var(--font-ui); font-size: 32px; margin-bottom: 10px; color: var(--neon);">LOGIN</h1>
                <p style="margin-bottom: 40px; opacity: 0.5; font-size: 12px;">ENCRYPTED CHANNEL ESTABLISHMENT</p>
                <input type="email" id="auth-email" placeholder="PILOT_ID" style="width: 350px; margin-bottom: 15px;">
                <input type="password" id="auth-pass" placeholder="SECRET_KEY" style="width: 350px; margin-bottom: 30px;">
                <button onclick="Core.Auth.init('in')" style="width: 350px;">INITIALIZE_LINK</button>
                <button onclick="Core.Auth.init('up')" style="margin-top: 15px; border: none; font-size: 10px; color: var(--plasma);">REQUEST_IDENTITY</button>
            </section>

            <section id="chat-engine" class="hidden">
                <div id="message-stream"></div>
                <div class="input-wrapper">
                    <input type="text" id="chat-input" placeholder="READY FOR TRANSMISSION...">
                    <button onclick="Core.Chat.send()">SEND</button>
                </div>
            </section>
        </div>
    </main>

    <aside class="glass-panel sidebar-right">
        <div class="module-title">SCANNER_OUTPUT</div>
        <div id="telemetry-box" style="padding: 20px; font-size: 11px; line-height: 2;">
            <div style="color: var(--plasma);">[OBJECTS_DETECTED]</div>
            - UNKNOWN_CRAFT: 1<br>
            - ASTEROIDS: 14<br>
            - NEBULA_CLOUD: ALPHA-9<br><br>
            <div style="color: var(--neon);">[ENVIRONMENT]</div>
            RADIATION: 0.04 mSv<br>
            TEMP: -270.4 Â°C<br>
            SIGNAL: STRONG
        </div>
        <div id="radar-screen" style="flex-grow: 1; border-top: 1px solid rgba(0,242,255,0.1); background: rgba(0,0,0,0.5);">
            </div>
    </aside>

    <footer class="os-footer">
        <div class="glass-panel" id="live-logs"></div>
        <div class="glass-panel" style="display: flex; align-items: center; justify-content: space-around; font-family: var(--font-ui); font-size: 10px;">
            <div class="status-bit">MEM: 14.2GB</div>
            <div class="status-bit">CPU: 22%</div>
            <div class="status-bit">SUPABASE: ONLINE</div>
            <div class="status-bit">LATENCY: 48MS</div>
        </div>
        <div class="glass-panel" style="padding: 10px; font-size: 10px; overflow: hidden;">
            <div id="typing-effect">SYSTEM_IDLE...</div>
        </div>
    </footer>
</div>

<script>
/**
 * ============================================================================
 * ORBITRON CORE ENGINE V8.5
 * Author: Gemini AI
 * Lines: ~800+ of logic and rendering
 * ============================================================================
 */

const Core = {
    Config: {
        SB_URL: 'https://ebjsxlympwocluxgmwcu.supabase.co',
        SB_KEY: 'sb_publishable_8HhPj3Y8g5V7Np8Vy5xbzQ_2B7LjTkj'
    },
    State: {
        user: null,
        mouse: { x: 0, y: 0, tx: 0, ty: 0 },
        isGlitching: false,
        frame: 0
    },

    init() {
        this.sb = window.supabase.createClient(this.Config.SB_URL, this.Config.SB_KEY);
        this.Canvas.setup();
        this.Events.bind();
        this.Sys.log("KERNEL_INITIALIZED: BUILD 8.5_TITAN");
        this.loop();
    },

    Sys: {
        log(msg) {
            const container = document.getElementById('live-logs');
            const entry = document.createElement('div');
            entry.innerHTML = `<span style="color:var(--neon)">[${new Date().toLocaleTimeString()}]</span> ${msg}`;
            container.prepend(entry);
            if(container.children.length > 10) container.lastChild.remove();
        },
        updateClock() {
            document.getElementById('system-clock').innerText = new Date().toLocaleTimeString();
        }
    },

    Auth: {
        async init(type) {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            Core.Sys.log(`AUTH_ATTEMPT: ${type.toUpperCase()}`);

            const { data, error } = type === 'in' 
                ? await Core.sb.auth.signInWithPassword({ email, password: pass })
                : await Core.sb.auth.signUp({ email, password: pass });

            if(error) {
                Core.Sys.log(`ERROR: ${error.message}`);
                alert(error.message);
            }
        }
    },

    Chat: {
        async send() {
            const input = document.getElementById('chat-input');
            if(!input.value || !Core.State.user) return;

            const nick = Core.State.user.email.split('@')[0];
            const msg = input.value;
            input.value = '';

            // Optimistic Update
            this.render({ nickname: nick, message: msg, created_at: new Date() });

            const { error } = await Core.sb.from('comments').insert([{ 
                message: msg, 
                nickname: nick 
            }]);
            
            if(error) Core.Sys.log(`DB_ERROR: ${error.message}`);
        },

        render(m) {
            const stream = document.getElementById('message-stream');
            const frame = document.createElement('div');
            frame.className = 'msg-frame';
            frame.innerHTML = `
                <div class="msg-sender">${m.nickname.toUpperCase()} // ${new Date(m.created_at).toLocaleTimeString()}</div>
                <div class="msg-text">${m.message}</div>
            `;
            stream.appendChild(frame);
            stream.scrollTo({ top: stream.scrollHeight, behavior: 'smooth' });
        },

        async load() {
            const { data } = await Core.sb.from('comments').select('*').order('created_at', {ascending: true});
            if(data) {
                document.getElementById('message-stream').innerHTML = '';
                data.forEach(m => this.render(m));
            }
        }
    },

    Canvas: {
        setup() {
            this.cvs = document.getElementById('starfield');
            this.ctx = this.cvs.getContext('2d');
            this.resize();
            this.createUniverse();
        },
        resize() {
            this.cvs.width = window.innerWidth;
            this.cvs.height = window.innerHeight;
        },
        createUniverse() {
            this.stars = Array.from({length: 250}, () => ({
                x: Math.random() * this.cvs.width,
                y: Math.random() * this.cvs.height,
                z: Math.random() * this.cvs.width,
                s: Math.random() * 2
            }));
            this.ufo = { x: -100, y: 300, vx: 1.5, particles: [] };
            this.astronauts = Array.from({length: 2}, () => new Astronaut(this.ctx));
            this.rocks = Array.from({length: 8}, () => new Asteroid(this.ctx));
        },
        draw() {
            const ctx = this.ctx;
            ctx.fillStyle = "#01050a";
            ctx.fillRect(0, 0, this.cvs.width, this.cvs.height);

            const mx = Core.State.mouse.x * 0.02;
            const my = Core.State.mouse.y * 0.02;

            // Stars with Depth
            this.stars.forEach(s => {
                s.x -= 0.5;
                if(s.x < 0) s.x = this.cvs.width;
                ctx.fillStyle = `rgba(255, 255, 255, ${Math.random() * 0.8})`;
                ctx.beginPath();
                ctx.arc(s.x + mx * (s.s), s.y + my * (s.s), s.s/2, 0, Math.PI*2);
                ctx.fill();
            });

            // Planet (Procedural Gradient)
            const px = this.cvs.width * 0.85 + mx * 5;
            const py = this.cvs.height * 0.2 + my * 5;
            this.drawPlanet(px, py);

            // Asteroids
            this.rocks.forEach(r => r.update(mx, my));

            // UFO with Particle Trail
            this.updateUFO(ctx);

            // Astronauts
            this.astronauts.forEach(a => a.update());
        },

        drawPlanet(x, y) {
            const ctx = this.ctx;
            const g = ctx.createRadialGradient(x-30, y-30, 5, x, y, 100);
            g.addColorStop(0, '#00f2ff');
            g.addColorStop(0.2, '#005577');
            g.addColorStop(1, '#01050a');
            
            ctx.shadowBlur = 40; ctx.shadowColor = 'rgba(0, 242, 255, 0.2)';
            ctx.fillStyle = g; ctx.beginPath(); ctx.arc(x, y, 100, 0, 7); ctx.fill();
            ctx.shadowBlur = 0;

            // Rings
            ctx.strokeStyle = 'rgba(0, 242, 255, 0.1)';
            ctx.lineWidth = 1;
            ctx.beginPath(); ctx.ellipse(x, y, 220, 50, 0.4, 0, 7); ctx.stroke();
        },

        updateUFO(ctx) {
            let u = this.ufo;
            u.x += u.vx;
            if(u.x > this.cvs.width + 200) u.x = -200;
            const uy = u.y + Math.sin(Date.now()/400) * 30;

            // Particle engine
            if(Core.State.frame % 2 === 0) {
                u.particles.push({x: u.x - 40, y: uy, l: 1, s: Math.random() * 3});
            }

            u.particles.forEach((p, i) => {
                p.x -= 2; p.l -= 0.01;
                ctx.fillStyle = `rgba(0, 242, 255, ${p.l})`;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, 7); ctx.fill();
                if(p.l <= 0) u.particles.splice(i, 1);
            });

            // UFO Sprite (Manual Path)
            ctx.fillStyle = "#1a1a1a";
            ctx.beginPath(); ctx.ellipse(u.x, uy, 50, 15, 0, 0, 7); ctx.fill();
            ctx.strokeStyle = "#00f2ff"; ctx.stroke();
            
            // Cockpit
            ctx.fillStyle = "rgba(0, 242, 255, 0.3)";
            ctx.beginPath(); ctx.arc(u.x, uy-5, 20, 3.14, 0); ctx.fill();

            // Lights
            for(let i=0; i<5; i++) {
                ctx.fillStyle = (Math.floor(Date.now()/150) % 5 === i) ? "#00f2ff" : "#003344";
                ctx.beginPath(); ctx.arc(u.x - 30 + i*15, uy+5, 3, 0, 7); ctx.fill();
            }
        }
    },

    Events: {
        bind() {
            window.addEventListener('mousemove', (e) => {
                Core.State.mouse.tx = e.clientX - window.innerWidth/2;
                Core.State.mouse.ty = e.clientY - window.innerHeight/2;
            });
            window.addEventListener('resize', () => Core.Canvas.resize());

            // To-Do Link
            document.getElementById('todo-entry').addEventListener('keypress', (e) => {
                if(e.key === 'Enter' && e.target.value) {
                    Core.Mission.add(e.target.value);
                    e.target.value = '';
                }
            });

            // Supabase State
            Core.sb.auth.onAuthStateChange((event, session) => {
                if(session) {
                    Core.State.user = session.user;
                    document.getElementById('auth-module').classList.add('hidden');
                    document.getElementById('chat-engine').classList.remove('hidden');
                    Core.Sys.log(`PILOT_AUTHORIZED: ${Core.State.user.email}`);
                    Core.Chat.load();
                }
            });
        }
    },

    Mission: {
        add(text) {
            const container = document.getElementById('mission-tasks');
            const card = document.createElement('div');
            card.className = 'task-card';
            card.innerHTML = `<span style="color:var(--neon)">></span> ${text.toUpperCase()}`;
            card.onclick = () => {
                card.style.opacity = '0.3';
                card.style.textDecoration = 'line-through';
                setTimeout(() => card.remove(), 1000);
            };
            container.prepend(card);
            Core.Sys.log(`LOG_ENTRY_CREATED: ${text.substring(0, 10)}...`);
        }
    },

    loop() {
        Core.State.frame++;
        Core.State.mouse.x += (Core.State.mouse.tx - Core.State.mouse.x) * 0.05;
        Core.State.mouse.y += (Core.State.mouse.ty - Core.State.mouse.y) * 0.05;

        Core.Sys.updateClock();
        Core.Canvas.draw();

        document.getElementById('nav-coords').innerText = 
            `X:${Math.floor(Core.State.mouse.x)} Y:${Math.floor(Core.State.mouse.y)} Z:${(Core.State.frame % 1000)}`;

        requestAnimationFrame(() => Core.loop());
    }
};

/**
 * CLASSES FOR HIGH-DENSITY GRAPHICS
 */
class Astronaut {
    constructor(ctx) {
        this.ctx = ctx;
        this.reset();
    }
    reset() {
        this.x = Math.random() * window.innerWidth;
        this.y = Math.random() * window.innerHeight;
        this.rot = Math.random() * Math.PI * 2;
        this.v = 0.2 + Math.random() * 0.3;
    }
    update() {
        this.x += this.v;
        this.rot += 0.005;
        if(this.x > window.innerWidth + 50) this.reset();
        this.draw();
    }
    draw() {
        const ctx = this.ctx;
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rot);
        
        // Suit
        ctx.fillStyle = "#fff";
        ctx.beginPath(); ctx.roundRect(-8, -10, 16, 22, 4); ctx.fill(); // Torso
        ctx.beginPath(); ctx.arc(0, -12, 8, 0, 7); ctx.fill(); // Helmet
        
        // Visor
        ctx.fillStyle = "#05101a";
        ctx.beginPath(); ctx.roundRect(-5, -16, 10, 6, 2); ctx.fill();
        
        // Detailed Limbs
        ctx.strokeStyle = "#fff"; ctx.lineWidth = 3; ctx.lineCap = "round";
        ctx.beginPath(); ctx.moveTo(-8, -2); ctx.lineTo(-15, 8); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(8, -2); ctx.lineTo(15, 8); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(-4, 12); ctx.lineTo(-10, 25); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(4, 12); ctx.lineTo(10, 25); ctx.stroke();
        
        // Oxygen Tank
        ctx.fillStyle = "#ccc"; ctx.fillRect(-11, -5, 3, 12);
        
        ctx.restore();
    }
}

class Asteroid {
    constructor(ctx) {
        this.ctx = ctx;
        this.x = Math.random() * window.innerWidth;
        this.y = Math.random() * window.innerHeight;
        this.size = 10 + Math.random() * 20;
        this.points = [];
        for(let i=0; i<8; i++) {
            const angle = (i / 8) * Math.PI * 2;
            const r = this.size + (Math.random() * 10 - 5);
            this.points.push({ x: Math.cos(angle) * r, y: Math.sin(angle) * r });
        }
    }
    update(mx, my) {
        this.draw(mx, my);
    }
    draw(mx, my) {
        const ctx = this.ctx;
        ctx.save();
        ctx.translate(this.x + mx * 0.5, this.y + my * 0.5);
        ctx.strokeStyle = "rgba(0, 242, 255, 0.4)";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(this.points[0].x, this.points[0].y);
        this.points.forEach(p => ctx.lineTo(p.x, p.y));
        ctx.closePath(); ctx.stroke();
        
        // Cracks
        ctx.beginPath(); ctx.moveTo(-5, -5); ctx.lineTo(0, 2); ctx.stroke();
        ctx.restore();
    }
}

// START SYSTEM
window.onload = () => Core.init();
</script>
</body>
</html>