<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ORBITRON TERMINAL v7.8</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --n: #00f2ff; --p: #ff00ff; --bg: #01050a; --gl: rgba(5, 15, 25, 0.9); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg); color: var(--n); font-family: 'Share Tech Mono', monospace; height: 100vh; overflow: hidden; }
        
        #canvas-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; display: flex; pointer-events: none; }
        .sidebar { width: 300px; height: 100%; background: var(--gl); border-right: 1px solid var(--n); padding: 30px; pointer-events: auto; backdrop-filter: blur(15px); display: flex; flex-direction: column; }
        .main-terminal-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; pointer-events: none; }
        
        .terminal-box { 
            width: 650px; background: var(--gl); border: 1px solid var(--n); padding: 30px; pointer-events: auto; 
            position: relative; backdrop-filter: blur(12px); border-radius: 4px; box-shadow: 0 0 40px rgba(0,242,255,0.15); 
        }

        @keyframes glitch { 0% { transform: translate(0); } 20% { transform: translate(-4px, 2px); filter: hue-rotate(90deg); } 100% { transform: translate(0); } }
        .glitch-active { animation: glitch 0.25s linear 2; }

        #chat-box { height: 450px; overflow-y: auto; margin-bottom: 20px; display: flex; flex-direction: column; scroll-behavior: smooth; }
        .msg { background: rgba(0, 242, 255, 0.03); border-left: 3px solid var(--n); padding: 12px; margin-bottom: 10px; animation: slideIn 0.2s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-15px); } to { opacity: 1; transform: translateX(0); } }

        input { background: rgba(0,0,0,0.85); border: 1px solid var(--n); color: #fff; padding: 15px; width: 100%; font-family: inherit; outline: none; margin-bottom: 10px; border-radius: 2px; }
        button { background: transparent; color: var(--n); border: 1px solid var(--n); padding: 12px; width: 100%; cursor: pointer; font-family: 'Orbitron'; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; }
        button:hover { background: var(--n); color: #000; box-shadow: 0 0 20px var(--n); }

        h2 { font-family: 'Orbitron'; font-size: 13px; letter-spacing: 2px; margin-bottom: 15px; color: var(--p); text-shadow: 0 0 5px var(--p); }
        .hidden { display: none; }
    </style>
</head>
<body>

<canvas id="canvas-bg"></canvas>

<div class="ui-layer">
    <div class="sidebar">
        <h2>MISSION_LOGS</h2>
        <div id="todo-list" style="overflow-y:auto; flex-grow:1; font-size:12px; color: rgba(0,242,255,0.7);">
            <div>> SYSTEM_BOOT_COMPLETE</div>
            <div>> ENCRYPTION_ACTIVE</div>
            <div>> CONNECTION_SECURE</div>
        </div>
        <div style="margin-top: 20px; border-top: 1px solid rgba(0,242,255,0.2); padding-top:15px; font-size:11px;">
            <div id="sys-status" style="color:var(--n)">STATUS: STANDBY</div>
            <div id="clock" style="margin-top:5px; opacity:0.6;">00:00:00</div>
        </div>
    </div>
    
    <div class="main-terminal-area">
        <div class="terminal-box" id="main-terminal">
            <div id="auth-ui">
                <h1 style="text-align: center; margin-bottom: 25px; font-family: 'Orbitron'; font-size: 18px; color: var(--n);">ORBITRON_LOGIN</h1>
                <input type="email" id="email" placeholder="PILOT_ID (EMAIL)">
                <input type="password" id="pass" placeholder="ACCESS_CODE">
                <button onclick="handleAuth('in')">ESTABLISH_LINK</button>
                <button onclick="handleAuth('up')" style="margin-top:10px; border-color:var(--p); color:var(--p)">REGISTER_NEW_PILOT</button>
            </div>
            
            <div id="chat-ui" class="hidden">
                <div id="chat-box"></div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="msg-in" placeholder="TRANSMIT SIGNAL..." onkeypress="if(event.key==='Enter') sendMsg()">
                    <button onclick="sendMsg()" style="width: 120px;">SEND</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
(function() {
    const URL = 'https://ebjsxlympwocluxgmwcu.supabase.co';
    const KEY = 'sb_publishable_8HhPj3Y8g5V7Np8Vy5xbzQ_2B7LjTkj';
    const sb = window.supabase.createClient(URL, KEY);

    window.getNickColor = (s) => {
        let h = 0;
        Array.from(s).forEach(c => h = c.charCodeAt(0) + ((h << 5) - h));
        return 'hsl(' + (Math.abs(h) % 360) + ', 80%, 70%)';
    };

    window.handleAuth = async (type) => {
        const e = document.getElementById('email').value, p = document.getElementById('pass').value;
        const { error } = type === 'in' ? await sb.auth.signInWithPassword({email: e, password: p}) : await sb.auth.signUp({email: e, password: p});
        if(error) alert(error.message);
    };

    sb.auth.onAuthStateChange((event, session) => {
        const isAuth = !!session;
        document.getElementById('auth-ui').classList.toggle('hidden', isAuth);
        document.getElementById('chat-ui').classList.toggle('hidden', !isAuth);
        if(isAuth) {
            document.getElementById('sys-status').innerText = "STATUS: ONLINE";
            loadMessages();
        }
    });

    async function loadMessages() {
        const { data } = await sb.from('comments').select('*').order('created_at', {ascending: true});
        if(data) {
            const box = document.getElementById('chat-box');
            box.innerHTML = '';
            data.forEach(m => renderMessage(m));
            box.scrollTop = box.scrollHeight;
        }
    }

    function renderMessage(m) {
        const box = document.getElementById('chat-box');
        const d = document.createElement('div');
        d.className = 'msg';
        const nick = m.nickname || 'Unknown';
        d.innerHTML = '<span style="color:'+getNickColor(nick)+'; font-weight:bold; text-transform:uppercase; font-size:11px;">'+nick+'</span><br><span style="color:#fff">'+m.message+'</span>';
        box.appendChild(d);
        box.scrollTop = box.scrollHeight;
    }

    window.sendMsg = async () => {
        const input = document.getElementById('msg-in');
        const { data: { user } } = await sb.auth.getUser();
        if(input.value && user) {
            const nick = user.email.split('@')[0], msg = input.value;
            input.value = '';
            await sb.from('comments').insert([{message: msg, nickname: nick}]);
            renderMessage({nickname: nick, message: msg});
        }
    };

    sb.channel('public:comments').on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'comments' }, payload => {
        sb.auth.getUser().then(({data}) => {
            if(data.user && data.user.email.split('@')[0] !== payload.new.nickname) {
                renderMessage(payload.new);
                const t = document.getElementById('main-terminal');
                t.classList.add('glitch-active');
                setTimeout(() => t.classList.remove('glitch-active'), 300);
            }
        });
    }).subscribe();

    // --- ENGINE: ADVANCED COSMOS ---
    const canvas = document.getElementById('canvas-bg');
    const ctx = canvas.getContext('2d');
    let stars = [], stones = [], astronauts = [], ufo = { x: -150, y: 200, phase: 0 };

    function init() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        stars = Array.from({length: 120}, () => ({x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: Math.random()*1.8, op: Math.random()}));
        stones = Array.from({length: 6}, () => ({
            x: Math.random()*canvas.width, y: Math.random()*canvas.height, 
            s: 0.3 + Math.random()*0.6,
            rot: Math.random()*Math.PI,
            vRot: (Math.random()-0.5)*0.02,
            pts: Array.from({length:8}, (_, i) => ({
                x: Math.cos(i*Math.PI/4)*(15+Math.random()*10),
                y: Math.sin(i*Math.PI/4)*(15+Math.random()*10)
            }))
        }));
        astronauts = Array.from({length: 3}, () => ({
            x: Math.random()*canvas.width, y: Math.random()*canvas.height, 
            vx: 0.15, vy: 0.08, r: Math.random()*Math.PI*2, vr: 0.005
        }));
    }

    function draw() {
        ctx.fillStyle = '#01050a';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Stars with Twinkle
        stars.forEach(s => {
            ctx.fillStyle = 'rgba(255,255,255,'+(0.3 + Math.abs(Math.sin(Date.now()/1000 + s.x))*0.7)+')';
            ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, 7); ctx.fill();
        });

        // Planet & Rings
        const px = canvas.width*0.85, py = canvas.height*0.2;
        ctx.fillStyle = '#003355'; ctx.beginPath(); ctx.arc(px, py, 60, 0, 7); ctx.fill();
        ctx.strokeStyle = 'rgba(0,242,255,0.1)'; ctx.lineWidth = 3;
        ctx.beginPath(); ctx.ellipse(px, py, 150, 30, 0.4, 0, 7); ctx.stroke();

        // Advanced Stones
        stones.forEach(s => {
            s.y += s.s; s.rot += s.vRot; if(s.y > canvas.height + 50) s.y = -50;
            ctx.save(); ctx.translate(s.x, s.y); ctx.rotate(s.rot);
            ctx.fillStyle = '#16212d'; ctx.beginPath();
            s.pts.forEach((p, i) => i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y));
            ctx.closePath(); ctx.fill(); ctx.strokeStyle = '#2a3b4d'; ctx.stroke();
            ctx.restore();
        });

        // Detailed Astronauts
        astronauts.forEach(a => {
            a.x += a.vx; a.y += a.vy; a.r += a.vr; if(a.x > canvas.width + 100) a.x = -100;
            ctx.save(); ctx.translate(a.x, a.y); ctx.rotate(a.r);
            // Backpack
            ctx.fillStyle = '#ccc'; ctx.fillRect(-10, -8, 6, 16);
            // Body
            ctx.fillStyle = '#fff'; ctx.fillRect(-6, -10, 12, 20);
            // Visor
            ctx.fillStyle = '#111'; ctx.fillRect(-3, -7, 7, 5);
            // Arms/Legs (Simple)
            ctx.strokeStyle = '#fff'; ctx.lineWidth = 3;
            ctx.strokeRect(-6, -10, 12, 20);
            ctx.restore();
        });

        // Pro UFO
        ufo.x += 1.2; if(ufo.x > canvas.width + 200) ufo.x = -200;
        ufo.phase = Math.sin(Date.now()/400);
        let uy = ufo.y + ufo.phase*20;
        // Base
        ctx.fillStyle = '#2c2c2c'; ctx.beginPath(); ctx.ellipse(ufo.x, uy, 45, 12, 0, 0, 7); ctx.fill();
        ctx.strokeStyle = '#444'; ctx.stroke();
        // Cockpit
        let grad = ctx.createLinearGradient(ufo.x, uy-15, ufo.x, uy);
        grad.addColorStop(0, 'rgba(0,242,255,0.8)'); grad.addColorStop(1, 'rgba(0,242,255,0.2)');
        ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(ufo.x, uy-4, 15, Math.PI, 0); ctx.fill();
        // Lights
        [ -25, 0, 25 ].forEach(off => {
            ctx.fillStyle = (Math.floor(Date.now()/200)%2 === 0) ? '#0ff' : '#f0f';
            ctx.beginPath(); ctx.arc(ufo.x + off, uy+3, 2.5, 0, 7); ctx.fill();
        });

        document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        requestAnimationFrame(draw);
    }

    window.addEventListener('resize', init);
    init(); draw();
})();
</script>
</body>
</html>