<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>ORBITRON v9.0 - VOID FOCUS</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
    --n:#00f2ff;
    --p:#ff00ff;
    --bg:#01050a;
    --glass:rgba(0,242,255,0.05);
    --border:rgba(0,242,255,0.2);
}

*{box-sizing:border-box;margin:0;padding:0;}

body{
    background:var(--bg);
    color:var(--n);
    font-family:'Share Tech Mono', monospace;
    height:100vh;
    overflow:hidden;
}

#starfield{
    position:fixed;
    inset:0;
    z-index:1;
}

/* Центрируем всё */
.viewport{
    position:relative;
    z-index:10;
    display:flex;
    flex-direction:column;
    align-items:center;
    height:100vh;
    padding:20px;
}

.header{
    width:100%;
    max-width:700px;
    display:flex;
    justify-content:space-between;
    padding:15px;
    border-bottom:1px solid var(--border);
    font-family:'Orbitron';
}

/* ЧАТ */
.chat-panel{
    width:100%;
    max-width:650px;
    height:75vh;
    background:var(--glass);
    backdrop-filter:blur(12px);
    border:1px solid var(--border);
    display:flex;
    flex-direction:column;
    box-shadow:0 0 40px rgba(0,0,0,0.6);
}

#chat-stream{
    flex:1;
    overflow-y:auto;
    padding:20px;
    display:flex;
    flex-direction:column;
    gap:12px;
}

.msg-nick{
    font-size:10px;
    color:var(--p);
    font-family:'Orbitron';
}

.msg-text{
    background:rgba(0,242,255,0.07);
    padding:10px 15px;
    border-radius:0 10px 10px 10px;
    border:1px solid rgba(0,242,255,0.15);
    color:#e0faff;
}

.input-bar{
    display:flex;
    gap:10px;
    padding:15px;
    border-top:1px solid var(--border);
}

input{
    flex:1;
    background:rgba(0,0,0,0.6);
    border:1px solid var(--border);
    color:#fff;
    padding:12px;
    outline:none;
}

button{
    background:transparent;
    border:1px solid var(--n);
    color:var(--n);
    padding:10px 20px;
    font-family:'Orbitron';
    cursor:pointer;
}

button:hover{
    background:var(--n);
    color:#000;
}

#auth-gate{
    position:fixed;
    inset:0;
    z-index:100;
    background:var(--bg);
    display:flex;
    align-items:center;
    justify-content:center;
}
.hidden{display:none!important;}
</style>
</head>

<body>

<canvas id="starfield"></canvas>

<div id="auth-gate">
<div style="width:350px;text-align:center;border:1px solid var(--n);padding:50px;backdrop-filter:blur(10px);">
<h1 style="font-family:'Orbitron';margin-bottom:30px;">OMNI_v9.0</h1>
<input type="email" id="email" placeholder="PILOT_ID" style="width:100%;margin-bottom:10px;">
<input type="password" id="pass" placeholder="PASSWORD" style="width:100%;margin-bottom:25px;">
<button onclick="Core.Auth('in')" style="width:100%;">INITIALIZE</button>
</div>
</div>

<div class="viewport">
<header class="header">
<div>ORBITRON_SYSTEM // FOCUS</div>
<div id="clock">00:00:00</div>
</header>

<main class="chat-panel">
<div id="chat-stream"></div>
<div class="input-bar">
<input type="text" id="chat-in" placeholder="ENTER TELEMETRY DATA...">
<button onclick="Core.Chat.send()">SEND</button>
</div>
</main>
</div>

<script>
const Core = {
sb: window.supabase.createClient(
'https://ebjsxlympwocluxgmwcu.supabase.co',
'sb_publishable_8HhPj3Y8g5V7Np8Vy5xbzQ_2B7LjTkj'
),
user:null,

init(){
this.Canvas.init();
this.AuthListener();
this.UI();
setInterval(()=>document.getElementById('clock').innerText=new Date().toLocaleTimeString(),1000);
this.loop();
},

Auth:async(t)=>{
const e=email.value,p=pass.value;
const {error}=await Core.sb.auth.signInWithPassword({email:e,password:p});
if(error)alert(error.message);
},

AuthListener(){
this.sb.auth.onAuthStateChange((_,s)=>{
if(s){
this.user=s.user;
auth-gate.classList.add('hidden');
this.Chat.load();
this.Chat.subscribe();
}
});
},

Chat:{
async load(){
const {data}=await Core.sb.from('comments').select('*').order('created_at',{ascending:true});
if(data)data.forEach(m=>this.render(m));
},

subscribe(){
Core.sb.channel('comments')
.on('postgres_changes',{event:'INSERT',schema:'public',table:'comments'},
payload=>{
if(payload.new.nickname!==Core.user.email.split('@')[0]){
this.notify(payload.new);
}
this.render(payload.new);
})
.subscribe();
},

notify(m){
const n=document.createElement('div');
n.style.position='fixed';
n.style.bottom='20px';
n.style.right='20px';
n.style.padding='15px 20px';
n.style.background='rgba(0,0,0,0.9)';
n.style.border='1px solid #00f2ff';
n.style.color='#00f2ff';
n.style.fontFamily='Orbitron';
n.textContent='NEW MESSAGE FROM '+m.nickname.toUpperCase();
document.body.appendChild(n);
setTimeout(()=>n.remove(),3000);
},

render(m){
const s=document.getElementById('chat-stream');
const d=document.createElement('div');
const nick=document.createElement('div');
nick.className='msg-nick';
nick.textContent=(m.nickname||'PILOT').toUpperCase();
const text=document.createElement('div');
text.className='msg-text';
text.textContent=m.message;
d.appendChild(nick);
d.appendChild(text);
s.appendChild(d);
s.scrollTop=s.scrollHeight;
},

async send(){
const i=document.getElementById('chat-in');
if(!i.value||!Core.user)return;
if(i.value.length>300)return;
const n=Core.user.email.split('@')[0];
const v=i.value;
i.value='';
await Core.sb.from('comments').insert([{message:v,nickname:n}]);
}
},

UI() {
    const chatInput = document.getElementById('chat-in');

    chatInput.onkeypress = (e) => {
        if (e.key === 'Enter') {
            Core.Chat.send();
        }
    };
}

,Canvas:{
init(){
this.cvs=starfield;
this.ctx=this.cvs.getContext('2d');
this.resize();
window.onresize=()=>this.resize();
this.stars=Array.from({length:200},()=>({x:Math.random()*this.cvs.width,y:Math.random()*this.cvs.height,v:Math.random()*0.5}));
this.astronauts=Array.from({length:4},()=>({
x:Math.random()*this.cvs.width,
y:Math.random()*this.cvs.height,
speed:0.3+Math.random()*0.5,
size:20+Math.random()*20
}));
},

resize(){
this.cvs.width=innerWidth;
this.cvs.height=innerHeight;
},

draw(){
const ctx=this.ctx,cvs=this.cvs;
ctx.fillStyle='#01050a';
ctx.fillRect(0,0,cvs.width,cvs.height);

ctx.fillStyle='#fff';
this.stars.forEach(s=>{
s.x-=s.v;
if(s.x<0)s.x=cvs.width;
ctx.beginPath();
ctx.arc(s.x,s.y,1,0,7);
ctx.fill();
});

this.astronauts.forEach(a=>{
a.x-=a.speed;
if(a.x<-50)a.x=cvs.width+50;
ctx.save();
ctx.translate(a.x,a.y);
ctx.strokeStyle='#00f2ff';
ctx.beginPath();
ctx.arc(0,0,a.size/4,0,Math.PI*2);
ctx.stroke();
ctx.beginPath();
ctx.arc(0,-a.size/3,a.size/5,0,Math.PI*2);
ctx.stroke();
ctx.restore();
});
}
},

loop(){Core.Canvas.draw();requestAnimationFrame(()=>Core.loop());}
};

window.onload=()=>Core.init();
</script>

</body>
</html>