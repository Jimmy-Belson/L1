<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ORBITRON v8.6 - VOID</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --n: #00f2ff;
            --p: #ff00ff;
            --bg: #01050a;
            --glass: rgba(0, 242, 255, 0.03);
            --border: rgba(0, 242, 255, 0.2);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            background: var(--bg); color: var(--n); 
            font-family: 'Share Tech Mono', monospace; 
            height: 100vh; overflow: hidden; 
        }

        #starfield { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }

        /* Эффект старого монитора (минимум помех для чистоты) */
        .crt::after {
            content: " "; display: block; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            z-index: 1000; background-size: 100% 4px; pointer-events: none; opacity: 0.2;
        }

        /* ОСНОВНАЯ СЕТКА - СДЕЛАЛИ ЕЕ МАКСИМАЛЬНО ОТКРЫТОЙ */
        .os-wrapper {
            position: relative; z-index: 10;
            display: grid;
            grid-template-columns: 300px 1fr;
            grid-template-rows: 60px 1fr;
            height: 100vh; padding: 20px; gap: 20px;
        }

        /* HEADER */
        header {
            grid-column: 1 / 3;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        /* TODO СЛЕВА - ТЕПЕРЬ ПРОЗРАЧНЫЙ */
        .todo-panel {
            background: var(--glass);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column;
            padding: 10px;
            backdrop-filter: blur(2px);
        }

        /* ЧАТ В ЦЕНТРЕ - ИСПРАВЛЕННЫЙ */
        .chat-container {
            display: flex; flex-direction: column;
            height: 100%; position: relative;
        }

        #message-stream {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex; flex-direction: column;
            gap: 15px;
            scrollbar-width: none;
        }

        .message {
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } }

        .msg-nick { font-family: 'Orbitron'; font-size: 10px; color: var(--p); margin-bottom: 4px; }
        .msg-body { 
            background: rgba(0, 242, 255, 0.07); 
            padding: 10px 15px; 
            border: 1px solid var(--border);
            color: #fff;
            border-radius: 0 10px 10px 10px;
        }

        /* ИНПУТЫ */
        .input-area {
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-top: 1px solid var(--border);
            display: flex; gap: 10px;
        }

        input {
            background: rgba(0,0,0,0.5); border: 1px solid var(--border);
            color: #fff; padding: 12px; font-family: inherit; outline: none; flex-grow: 1;
        }
        input:focus { border-color: var(--n); }

        button {
            background: transparent; border: 1px solid var(--n); color: var(--n);
            padding: 10px 20px; font-family: 'Orbitron'; cursor: pointer;
        }
        button:hover { background: var(--n); color: #000; }

        .hidden { display: none !important; }
        
        /* To-Do Item Style */
        .todo-item {
            font-size: 11px; padding: 8px; border-bottom: 1px solid rgba(0,242,255,0.1);
            cursor: pointer; transition: 0.2s;
        }
        .todo-item:hover { color: var(--p); padding-left: 15px; }

    </style>
</head>
<body class="crt">

<canvas id="starfield"></canvas>

<div class="os-wrapper">
    <header>
        <div style="font-family:'Orbitron'; font-weight:700; letter-spacing:3px;">ORBITRON_VOID_v8.6</div>
        <div id="clock">00:00:00</div>
    </header>

    <aside class="todo-panel">
        <div style="font-size:10px; letter-spacing:2px; margin-bottom:15px; color:var(--p)">[ MISSION_LOG ]</div>
        <input type="text" id="todo-in" placeholder="> ADD TASK..." style="margin-bottom:15px; font-size:12px;">
        <div id="todo-list" style="overflow-y:auto; flex-grow:1;"></div>
    </aside>

    <main class="chat-container">
        <div id="auth-gate" style="position:absolute; inset:0; z-index:20; background:var(--bg); display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <h2 style="font-family:'Orbitron'; margin-bottom:30px;">SECURE_ACCESS</h2>
            <input type="email" id="email" placeholder="PILOT_ID" style="max-width:300px; margin-bottom:10px;">
            <input type="password" id="pass" placeholder="PASSWORD" style="max-width:300px; margin-bottom:20px;">
            <button onclick="Core.Auth('in')" style="width:300px;">CONNECT</button>
            <button onclick="Core.Auth('up')" style="border:none; font-size:10px; margin-top:10px; color:var(--p)">REGISTER_NEW_ID</button>
        </div>

        <div id="message-stream"></div>
        
        <div class="input-area">
            <input type="text" id="msg-in" placeholder="TYPE TELEMETRY DATA...">
            <button onclick="Core.SendMessage()">SEND</button>
        </div>
    </main>
</div>

<script>
/**
 * ORBITRON CORE v8.6 - "VOID" ENGINE
 */
const Core = {
    sb: window.supabase.createClient('https://ebjsxlympwocluxgmwcu.supabase.co', 'sb_publishable_8HhPj3Y8g5V7Np8Vy5xbzQ_2B7LjTkj'),
    user: null,

    init() {
        this.Canvas.start();
        this.ListenAuth();
        this.UI.initTodo();
        
        // Clock
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        }, 1000);
    },

    Auth: async (type) => {
        const e = document.getElementById('email').value, p = document.getElementById('pass').value;
        const { error } = type === 'in' ? await Core.sb.auth.signInWithPassword({email:e, password:p}) : await Core.sb.auth.signUp({email:e, password:p});
        if(error) alert(error.message);
    },

    ListenAuth() {
        this.sb.auth.onAuthStateChange((_, session) => {
            if(session) {
                this.user = session.user;
                document.getElementById('auth-gate').classList.add('hidden');
                this.LoadMessages();
            }
        });
    },

    async LoadMessages() {
        const { data } = await this.sb.from('comments').select('*').order('created_at', {ascending: true});
        if(data) {
            data.forEach(m => this.RenderMsg(m));
        }
    },

    RenderMsg(m) {
        const stream = document.getElementById('message-stream');
        const div = document.createElement('div');
        div.className = 'message';
        div.innerHTML = `
            <div class="msg-nick">${(m.nickname || 'PILOT').toUpperCase()}</div>
            <div class="msg-body">${m.message}</div>
        `;
        stream.appendChild(div);
        stream.scrollTop = stream.scrollHeight;
    },

    SendMessage: async () => {
        const i = document.getElementById('msg-in');
        if(!i.value || !Core.user) return;
        const val = i.value, nick = Core.user.email.split('@')[0];
        i.value = '';
        Core.RenderMsg({ nickname: nick, message: val });
        await Core.sb.from('comments').insert([{ message: val, nickname: nick }]);
    },

    UI: {
        initTodo() {
            const input = document.getElementById('todo-in');
            input.onkeypress = (e) => {
                if(e.key === 'Enter' && input.value) {
                    const item = document.createElement('div');
                    item.className = 'todo-item';
                    item.innerText = '> ' + input.value.toUpperCase();
                    item.onclick = () => item.remove();
                    document.getElementById('todo-list').prepend(item);
                    input.value = '';
                }
            };
        }
    },

    Canvas: {
        start() {
            const cvs = document.getElementById('starfield');
            const ctx = cvs.getContext('2d');
            let stars = [], astronauts = [], ufo = { x: -100, y: 300, p: [] };

            const resize = () => { cvs.width = window.innerWidth; cvs.height = window.innerHeight; };
            window.onresize = resize; resize();

            // Init Stars
            for(let i=0; i<200; i++) stars.push({ x: Math.random()*cvs.width, y: Math.random()*cvs.height, s: Math.random()*2 });

            const draw = () => {
                ctx.fillStyle = '#01050a'; ctx.fillRect(0,0,cvs.width, cvs.height);

                // Stars
                ctx.fillStyle = '#fff';
                stars.forEach(s => {
                    ctx.globalAlpha = Math.random();
                    ctx.beginPath(); ctx.arc(s.x, s.y, s.s/2, 0, 7); ctx.fill();
                });
                ctx.globalAlpha = 1;

                // Planet
                const px = cvs.width * 0.8, py = cvs.height * 0.3;
                let g = ctx.createRadialGradient(px-20, py-20, 5, px, py, 80);
                g.addColorStop(0, '#00f2ff'); g.addColorStop(1, '#000810');
                ctx.fillStyle = g; ctx.beginPath(); ctx.arc(px, py, 80, 0, 7); ctx.fill();

                // Astronaut
                const ax = 150 + Math.sin(Date.now()/1000)*30, ay = 250;
                ctx.save(); ctx.translate(ax, ay); ctx.rotate(Math.sin(Date.now()/2000)*0.2);
                ctx.fillStyle = '#fff';
                ctx.beginPath(); ctx.arc(0, -15, 10, 0, 7); ctx.fill(); // Head
                ctx.fillRect(-10, -10, 20, 25); // Body
                ctx.strokeStyle = '#fff'; ctx.lineWidth = 4;
                ctx.beginPath(); ctx.moveTo(-10, 0); ctx.lineTo(-20, 15); ctx.stroke(); // Arms
                ctx.beginPath(); ctx.moveTo(10, 0); ctx.lineTo(20, 15); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(-5, 15); ctx.lineTo(-12, 35); ctx.stroke(); // Legs
                ctx.beginPath(); ctx.moveTo(5, 15); ctx.lineTo(12, 35); ctx.stroke();
                ctx.fillStyle = '#05101a'; ctx.fillRect(-6, -18, 12, 7); // Visor
                ctx.restore();

                // UFO
                ufo.x += 1.2; if(ufo.x > cvs.width + 100) ufo.x = -100;
                let uy = ufo.y + Math.sin(Date.now()/500)*30;
                
                // Trail
                if(Date.now() % 5 === 0) ufo.p.push({x: ufo.x - 40, y: uy, a: 1});
                ufo.p.forEach((p, idx) => {
                    p.x -= 1; p.a -= 0.01;
                    ctx.fillStyle = `rgba(0, 242, 255, ${p.a})`;
                    ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, 7); ctx.fill();
                    if(p.a <= 0) ufo.p.splice(idx, 1);
                });

                ctx.fillStyle = '#111'; ctx.beginPath(); ctx.ellipse(ufo.x, uy, 45, 12, 0, 0, 7); ctx.fill();
                ctx.strokeStyle = '#00f2ff'; ctx.lineWidth = 1; ctx.stroke();
                ctx.fillStyle = '#00f2ff'; 
                for(let i=0; i<5; i++) {
                    ctx.globalAlpha = (Math.floor(Date.now()/150)%5 === i) ? 1 : 0.2;
                    ctx.beginPath(); ctx.arc(ufo.x - 30 + i*15, uy + 3, 3, 0, 7); ctx.fill();
                }
                ctx.globalAlpha = 1;

                requestAnimationFrame(draw);
            }
            draw();
        }
    }
};

window.onload = () => Core.init();
</script>
</body>
</html>