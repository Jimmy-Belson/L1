<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ORBITRON TERMINAL v4.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --n: #00f2ff; --p: #ff00ff; --bg: #010812; --gl: rgba(10, 25, 47, 0.8); }
        body, html { margin: 0; padding: 0; background: var(--bg); color: var(--n); font-family: 'Share Tech Mono', monospace; height: 100vh; overflow: hidden; }
        #canvas-bg { position: fixed; top: 0; left: 0; z-index: 1; }
        .ui { position: relative; z-index: 10; display: flex; height: 100vh; pointer-events: none; }
        
        /* Боковая панель */
        .sidebar { width: 300px; background: var(--gl); border-right: 1px solid var(--n); padding: 25px; pointer-events: auto; backdrop-filter: blur(10px); display: flex; flex-direction: column; }
        
        /* Главный хаб */
        .hub { flex-grow: 1; display: flex; justify-content: center; align-items: center; }
        .terminal { width: 550px; background: var(--gl); border: 2px solid var(--n); padding: 30px; pointer-events: auto; position: relative; box-shadow: 0 0 20px rgba(0, 242, 255, 0.1); }
        .terminal::after { content: "SECURE_MODE"; position: absolute; top: -12px; right: 20px; background: var(--bg); color: var(--p); font-size: 10px; padding: 0 5px; border: 1px solid var(--p); }

        /* Чат */
        #chat-box { height: 380px; overflow-y: auto; margin-bottom: 20px; border-bottom: 1px solid rgba(0, 242, 255, 0.2); }
        .msg { background: rgba(0, 242, 255, 0.05); padding: 10px; margin-bottom: 10px; border-left: 3px solid var(--p); cursor: pointer; }
        .msg:hover { background: rgba(255, 0, 0, 0.1); border-left-color: #ff4d4d; }
        .msg-nick { color: var(--p); font-size: 11px; margin-bottom: 4px; display: block; }

        input { background: rgba(0,0,0,0.6); border: 1px solid var(--n); color: #fff; padding: 12px; width: calc(100% - 26px); font-family: inherit; outline: none; margin-bottom: 8px; }
        button { background: transparent; color: var(--n); border: 1px solid var(--n); padding: 12px; width: 100%; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 12px; letter-spacing: 1px; }
        button:hover { background: var(--n); color: #000; box-shadow: 0 0 15px var(--n); }

        h2 { font-family: 'Orbitron', sans-serif; font-size: 1.2rem; text-shadow: 0 0 10px var(--n); }
        .hidden { display: none; }
    </style>
</head>
<body>

<canvas id="canvas-bg"></canvas>

<div class="ui">
    <div class="sidebar">
        <h2>SYSTEM_LOG</h2>
        <input type="text" id="todo-in" placeholder="+ ADD OBJECTIVE">
        <div id="todo-list">
            <div class="msg" style="font-size: 12px;" onclick="this.remove()">SCANNING_VOID... [OK]</div>
        </div>
        <div style="margin-top: auto; font-size: 11px; opacity: 0.7; line-height: 2;">
            SECTOR: 004-X<br>
            HULL_INTEGRITY: 100%<br>
            POS: <span id="ufo-coords">0,0</span>
        </div>
    </div>

    <div class="hub">
        <div class="terminal">
            <div id="auth-ui">
                <h2 style="text-align: center;">IDENTIFICATION</h2>
                <input type="email" id="email" placeholder="PILOT_ID">
                <input type="password" id="pass" placeholder="PASSWORD">
                <button onclick="handleAuth('in')">LOGIN</button>
                <button onclick="handleAuth('up')" style="margin-top:5px; border-color:var(--p); color:var(--p);">REGISTER</button>
            </div>

            <div id="chat-ui" class="hidden">
                <div id="chat-box"></div>
                <div style="display: flex; gap: 5px;">
                    <input type="text" id="msg-in" placeholder="ENTER MESSAGE...">
                    <button onclick="sendMsg()" style="width: 80px;">SEND</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Настройки Supabase
    const URL = 'https://ebjsxlympwocluxgmwcu.supabase.co';
    const KEY = 'sb_publishable_8HhPj3Y8g5V7Np8Vy5xbzQ_2B7LjTkj';
    const client = window.supabase.createClient(URL, KEY);

    // Логика чата
    client.auth.onAuthStateChange((_, session) => {
        document.getElementById('auth-ui').classList.toggle('hidden', !!session);
        document.getElementById('chat-ui').classList.toggle('hidden', !session);
        if(session) syncChat();
    });

    async function handleAuth(mode) {
        const e = document.getElementById('email').value, p = document.getElementById('pass').value;
        const { error } = mode === 'in' ? await client.auth.signInWithPassword({email:e, password:p}) : await client.auth.signUp({email:e, password:p});
        if(error) alert(error.message);
    }

    async function syncChat() {
        const { data } = await client.from('comments').select('*').order('created_at', { ascending: true });
        const box = document.getElementById('chat-box');
        box.innerHTML = '';
        if(data) data.forEach(m => {
            const d = document.createElement('div');
            d.className = 'msg';
            d.innerHTML = `<span class="msg-nick">${m.nickname}</span>${m.message}`;
            d.onclick = async () => { if(confirm("Удалить?")) { await client.from('comments').delete().eq('id', m.id); syncChat(); } };
            box.appendChild(d);
        });
        box.scrollTop = box.scrollHeight;
    }

    async function sendMsg() {
        const i = document.getElementById('msg-in');
        const { data: { user } } = await client.auth.getUser();
        if(i.value && user) {
            const val = i.value; i.value = '';
            await client.from('comments').insert([{ message: val, nickname: user.email.split('@')[0] }]);
            syncChat();
        }
    }
    client.channel('chat').on('postgres_changes', { event: '*', schema: 'public', table: 'comments' }, syncChat).subscribe();

    // --- КОСМИЧЕСКИЙ ДВИЖОК ---
    const canvas = document.getElementById('canvas-bg');
    const ctx = canvas.getContext('2d');
    let stars = [], objects = [];

    function init() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        stars = []; objects = [];
        for(let i=0; i<300; i++) stars.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: Math.random()*1.5 });
        // Добавляем камешки
        for(let i=0; i<10; i++) objects.push({ type: 'stone', x: Math.random()*canvas.width, y: Math.random()*canvas.height, s: Math.random()*0.5+0.2, r: Math.random()*8+4 });
        // Добавляем космонавтов
        for(let i=0; i<2; i++) objects.push({ type: 'man', x: Math.random()*canvas.width, y: Math.random()*canvas.height, vx: 0.2, vy: 0.1, rot: 0 });
    }

    function draw() {
        ctx.fillStyle = '#010812';
        ctx.fillRect(0,0,canvas.width, canvas.height);
        
        // Звезды
        ctx.fillStyle = '#fff';
        stars.forEach(s => { ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI*2); ctx.fill(); });

        objects.forEach(o => {
            if(o.type === 'stone') {
                ctx.fillStyle = '#2c3e50';
                o.y += o.s; if(o.y > canvas.height) o.y = -20;
                ctx.beginPath(); ctx.arc(o.x, o.y, o.r, 0, 7); ctx.fill();
            } else {
                o.x += o.vx; o.y += o.vy; o.rot += 0.01;
                if(o.x > canvas.width) o.x = -30;
                ctx.save();
                ctx.translate(o.x, o.y); ctx.rotate(o.rot);
                ctx.fillStyle = 'white'; ctx.fillRect(-8, -10, 16, 20); // Тело
                ctx.fillStyle = '#333'; ctx.fillRect(-5, -7, 10, 6); // Шлем
                ctx.restore();
            }
        });

        requestAnimationFrame(draw);
    }

    init(); draw();
    window.onresize = init;
</script>
</body>
</html>